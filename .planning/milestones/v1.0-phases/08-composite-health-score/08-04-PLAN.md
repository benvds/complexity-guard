---
phase: 08-composite-health-score
plan: 04
type: execute
wave: 4
depends_on: ["08-03"]
requirements: [COMP-01, COMP-02, COMP-03, COMP-04]
files_modified:
  - docs/health-score.md
  - docs/getting-started.md
  - docs/cli-reference.md
  - docs/examples.md
  - README.md
  - publication/npm/README.md
  - publication/npm/packages/darwin-arm64/README.md
  - publication/npm/packages/darwin-x64/README.md
  - publication/npm/packages/linux-arm64/README.md
  - publication/npm/packages/linux-x64/README.md
  - publication/npm/packages/windows-x64/README.md
autonomous: true

must_haves:
  truths:
    - "Health score documentation page explains formula, normalization, weights, and aggregation"
    - "Getting started docs mention health score as a feature"
    - "CLI reference documents --save-baseline, --fail-health-below, and weights config"
    - "Examples page shows health score in console and JSON output"
    - "README features list includes health score"
    - "Publication READMEs mention health score"
    - "Documentation includes the baseline + ratchet workflow guide"
    - "No letter grades mentioned anywhere in docs"
  artifacts:
    - path: "docs/health-score.md"
      provides: "Dedicated health score documentation page"
      min_lines: 100
    - path: "README.md"
      provides: "Updated features list and example output"
      contains: "health"
    - path: "docs/cli-reference.md"
      provides: "Updated CLI flags and JSON schema"
      contains: "save-baseline"
    - path: "docs/examples.md"
      provides: "Health score usage examples"
      contains: "health"
  key_links:
    - from: "docs/getting-started.md"
      to: "docs/health-score.md"
      via: "link to health score page"
      pattern: "health-score"
    - from: "README.md"
      to: "docs/health-score.md"
      via: "docs link in README"
      pattern: "health-score"
---

<objective>
Create comprehensive documentation for the health score system including a dedicated docs page, and update all existing documentation to reflect the new feature.

Purpose: Users need to understand the scoring formula, how to use baselines, and how weight customization works. Per CLAUDE.md rules, all user-facing changes must be reflected in docs and publication READMEs.

Output: New docs/health-score.md page, updated README, docs pages, and all publication READMEs.
</objective>

<execution_context>
@/Users/benvds/.claude/get-shit-done/workflows/execute-plan.md
@/Users/benvds/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-composite-health-score/08-CONTEXT.md
@.planning/phases/08-composite-health-score/08-RESEARCH.md
@.planning/phases/08-composite-health-score/08-02-SUMMARY.md
@.planning/phases/08-composite-health-score/08-03-SUMMARY.md
@docs/getting-started.md
@docs/cli-reference.md
@docs/examples.md
@docs/cognitive-complexity.md (style reference for new docs page)
@README.md
@publication/npm/README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/health-score.md and update existing docs pages</name>
  <files>docs/health-score.md, docs/getting-started.md, docs/cli-reference.md, docs/examples.md</files>
  <action>
    **Create docs/health-score.md** following the style of docs/cognitive-complexity.md and docs/halstead-metrics.md (friendly, thorough, TanStack/Astro tone per locked decision):

    Structure:
    1. **Title + intro:** "Health Score" — what it is, why it matters, one-paragraph overview
    2. **How It Works:** High-level flow: raw metrics -> normalization -> weighted average -> score
    3. **The Formula:**
       - Sigmoid normalization: `sub_score = 100 / (1 + exp(k * (x - x0)))` where x0 = warning threshold, k = ln(4) / (error - warning)
       - Show a table of example values: x=1 -> ~99, x=10 -> 50, x=20 -> ~20, x=30 -> ~6 (for cyclomatic with default thresholds)
       - Explain each metric family's normalization:
         - Cyclomatic: uses cyclomatic complexity value
         - Cognitive: uses cognitive complexity value
         - Halstead: uses volume metric
         - Structural: average of function_length, params_count, nesting_depth sub-scores
       - Note: duplication excluded until implemented
    4. **Weights:**
       - Default weights table: cognitive 0.30, cyclomatic 0.20, halstead 0.15, structural 0.15 (duplication 0.20 reserved)
       - Effective weights: duplication excluded, remaining normalized to 1.0
       - Weight of 0 = excluded from scoring (still analyzed)
       - Partial override example in config
    5. **Score Aggregation:**
       - Function score: weighted sum of normalized sub-scores
       - File score: average of function scores (empty file = 100)
       - Project score: function-count-weighted average across files (no functions = 100)
    6. **Baseline + Ratchet Workflow:**
       - How to set baseline: `--save-baseline`
       - How it works in CI: score < baseline = exit 1
       - How to override from CLI: `--fail-health-below N`
       - Guide: "Start with suggested weights, improve code, eventually return to ideal defaults"
    7. **Enhanced --init:**
       - How optimization works (coordinate descent finds weights that maximize score)
       - Shows default vs suggested score
       - Writes config with optimized weights + baseline
    8. **Configuration Reference:**
       - Config snippet showing weights and baseline
    9. **Score Interpretation:**
       - >= 80: healthy (green)
       - 50-79: needs attention (yellow)
       - < 50: critical (red)
       - No letter grades — purely numeric

    **Update docs/getting-started.md:**
    - Add "Health Score" to the metric families overview section
    - Add link to docs/health-score.md
    - Mention --save-baseline and --init in the "Getting Started" workflow

    **Update docs/cli-reference.md:**
    - Add --save-baseline flag documentation
    - Update --fail-health-below documentation
    - Update --init description to mention enhanced analysis workflow
    - Add weights and baseline to the config schema section
    - Update JSON output schema to show health_score field in summary and per-function

    **Update docs/examples.md:**
    - Add "Health Score" section with:
      - Example console output showing "Health: 73" line
      - Example JSON output showing health_score in summary and per-function
      - Example jq recipes: `jq '.summary.health_score'`, `jq '.files[].functions[] | select(.health_score < 50)'`
      - Example baseline workflow: `complexity-guard --save-baseline src/`, then `complexity-guard --fail-health-below 70 src/`
  </action>
  <verify>All 4 docs files exist and contain health score content. No mention of letter grades (A-F) in any doc. Links between docs pages resolve correctly (relative paths).</verify>
  <done>docs/health-score.md is a complete standalone page. All existing docs reference health score. CLI reference has all new flags. Examples show real usage patterns.</done>
</task>

<task type="auto">
  <name>Task 2: Update README.md and all publication READMEs</name>
  <files>README.md, publication/npm/README.md, publication/npm/packages/darwin-arm64/README.md, publication/npm/packages/darwin-x64/README.md, publication/npm/packages/linux-arm64/README.md, publication/npm/packages/linux-x64/README.md, publication/npm/packages/windows-x64/README.md</files>
  <action>
    **README.md updates:**
    1. Update features list to include health score: "Composite health score (0-100) with configurable weights"
    2. Update example output section to show "Health: NN" line in console output
    3. Add health score to the metrics overview / "What it measures" section
    4. Add link to docs/health-score.md in the documentation links section
    5. Update config schema example to show weights and baseline fields
    6. If there's a "Quick Start" or workflow section, mention `--save-baseline` and `--init`

    **publication/npm/README.md updates:**
    1. Sync with main README changes (features list, metrics overview)
    2. Add health score mention

    **Platform package READMEs (all 5):**
    1. Update "What ComplexityGuard Measures" section to include health score
    2. Keep changes minimal and consistent across all 5 files

    Per CLAUDE.md rules: publication READMEs must stay in sync with main README whenever the main README is updated.
  </action>
  <verify>All 7 README files mention health score. No letter grades. Main README links to docs/health-score.md. Publication READMEs are consistent with main README.</verify>
  <done>All READMEs updated with health score feature. Publication READMEs in sync with main README. No letter grades mentioned.</done>
</task>

</tasks>

<verification>
1. docs/health-score.md exists with formula documentation, weight tables, baseline workflow guide
2. docs/getting-started.md mentions health score
3. docs/cli-reference.md documents --save-baseline, --fail-health-below, weights config, JSON schema
4. docs/examples.md has health score examples
5. README.md features health score
6. All 5 platform READMEs updated
7. publication/npm/README.md updated
8. `grep -ri "grade" docs/ README.md publication/` returns no A-F letter grade references in health score context
</verification>

<success_criteria>
- New docs/health-score.md page is comprehensive (formula, weights, baseline workflow, --init guide)
- All existing docs updated to reference health score
- CLI reference documents all new flags
- All 7 README files mention health score
- No letter grades (A-F) in any documentation
- Documentation tone matches TanStack/Astro friendly style per locked decision
</success_criteria>

<output>
After completion, create `.planning/phases/08-composite-health-score/08-04-SUMMARY.md`
</output>
