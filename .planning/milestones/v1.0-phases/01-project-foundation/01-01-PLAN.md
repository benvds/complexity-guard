---
phase: 01-project-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - build.zig
  - build.zig.zon
  - src/main.zig
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "Running `zig build` produces an executable binary in zig-out/bin/"
    - "Running `zig build test` executes the test suite and reports results"
    - "Running `zig build run` executes the binary and prints a version message"
    - "The produced binary is a single static file under 5 MB"
  artifacts:
    - path: "build.zig"
      provides: "Build script with exe, run, and test steps"
      contains: "complexity-guard"
    - path: "build.zig.zon"
      provides: "Package manifest with project metadata"
      contains: "complexity-guard"
    - path: "src/main.zig"
      provides: "CLI entry point with version output"
      contains: "pub fn main"
    - path: ".gitignore"
      provides: "Git ignore rules for Zig artifacts"
      contains: "zig-out"
  key_links:
    - from: "build.zig"
      to: "src/main.zig"
      via: "root_source_file reference"
      pattern: 'b\.path\("src/main\.zig"\)'
    - from: "build.zig"
      to: "zig-out/bin/complexity-guard"
      via: "installArtifact step"
      pattern: "installArtifact"
---

<objective>
Initialize the Zig project with build system, entry point, and test runner.

Purpose: Every subsequent plan depends on `zig build` and `zig build test` working. This establishes the foundation that all other phases build on.
Output: A building, runnable, testable Zig project producing a single static binary named `complexity-guard`.
</objective>

<execution_context>
@/home/ben/.claude/get-shit-done/workflows/execute-plan.md
@/home/ben/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-project-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zig project skeleton with build system</name>
  <files>build.zig, build.zig.zon, .gitignore</files>
  <action>
Create `build.zig` with the Zig 0.14+ module-based API (use `b.createModule()`, NOT the deprecated `setTarget`/`setBuildMode` pattern). Define three build steps:

1. **exe** step: Compile `src/main.zig` into a binary named `complexity-guard`. Use `b.standardTargetOptions(.{})` and `b.standardOptimizeOption(.{})` for cross-compilation support from day one.

2. **run** step: Run the compiled binary. Connect args passthrough via `run_cmd.addArgs(b.args)` so `zig build run -- --help` works.

3. **test** step: Compile and run tests from `src/main.zig` (which will transitively pull in all module tests via `@import`). Use the same target options. Use `std.testing.allocator` implicitly (Zig's test runner provides leak detection automatically).

Create `build.zig.zon` with:
- name: "complexity-guard"
- version: "0.1.0"
- minimum_zig_version: "0.14.0"
- Empty dependencies block (no external deps in Phase 1)
- paths array listing "build.zig", "build.zig.zon", "src"

Create `.gitignore` with entries for: `zig-out/`, `.zig-cache/`, `zig-cache/`, `zig-pkg/` (new local dependency cache in 2026). Also ignore common editor artifacts (`.vscode/`, `*.swp`).

IMPORTANT: Do NOT use `zig init` as it generates boilerplate we do not want. Create files manually to match exact project structure.

IMPORTANT: Verify the Zig version installed on this machine with `zig version` before writing build files. If the installed version's API differs from the 0.14+ patterns in research, adapt accordingly. The research patterns may need adjustment for the exact installed version.
  </action>
  <verify>
Run `zig build` -- must complete without errors. Run `ls -la zig-out/bin/complexity-guard` -- binary must exist. Run `file zig-out/bin/complexity-guard` -- must show statically linked executable. Run `du -h zig-out/bin/complexity-guard` -- must be under 5 MB.
  </verify>
  <done>
`zig build` succeeds, producing a statically-linked binary under 5 MB at `zig-out/bin/complexity-guard`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create entry point with version output and test runner wiring</name>
  <files>src/main.zig</files>
  <action>
Create `src/main.zig` as the CLI entry point. For Phase 1, it should:

1. Import `std` and set up an arena allocator wrapping `std.heap.page_allocator` with `defer arena.deinit()`.

2. Print a version string to stdout: "complexity-guard v0.1.0" followed by a newline. Use `std.io.getStdOut().writer()` for output.

3. Include a basic inline test block that verifies the version string format (test that a `version` constant exists and starts with "0.").

4. Add a `comptime` block or `test` block that references future module imports. For now, just comment placeholders: `// TODO: @import("core/types.zig")` -- this documents the intended module structure without breaking compilation.

5. Use `pub fn main() !void` signature (error union return for `try` propagation).

After creating main.zig, verify the full TDD loop works:
- `zig build test` runs and passes (green)
- `zig build run` prints the version string
- `zig build test --watch` starts file watching (Ctrl+C to exit -- just verify it starts)

This establishes the fast feedback loop per user decision: build and test must be quick to iterate.
  </action>
  <verify>
Run `zig build test` -- must pass with 0 failures. Run `zig build run` -- must print "complexity-guard v0.1.0" to stdout. Run `zig build 2>&1` -- must produce no warnings or errors.
  </verify>
  <done>
`zig build test` passes, `zig build run` prints version string, and the project is ready for TDD development with inline tests.
  </done>
</task>

</tasks>

<verification>
1. `zig build` completes without errors
2. `zig build test` completes without errors
3. `zig build run` prints "complexity-guard v0.1.0"
4. Binary exists at `zig-out/bin/complexity-guard` and is under 5 MB
5. `.gitignore` excludes `zig-out/`, `.zig-cache/`, `zig-cache/`, `zig-pkg/`
6. `zig build test --watch` starts successfully (verify it enters watch mode)
</verification>

<success_criteria>
- Zig project builds, tests, and runs from a clean checkout
- Binary is a single static executable under 5 MB
- TDD feedback loop operational: edit source, `zig build test` shows results within seconds
- All files committed and project skeleton is ready for core data structure development
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-01-SUMMARY.md`
</output>
