---
phase: 09-sarif-output
plan: 02
type: execute
wave: 2
depends_on:
  - 09-01
files_modified:
  - docs/sarif-output.md
  - docs/cli-reference.md
  - docs/getting-started.md
  - docs/examples.md
  - README.md
  - publication/npm/README.md
  - publication/npm/packages/darwin-arm64/README.md
  - publication/npm/packages/darwin-x64/README.md
  - publication/npm/packages/linux-arm64/README.md
  - publication/npm/packages/linux-x64/README.md
  - publication/npm/packages/windows-x64/README.md
autonomous: true
requirements:
  - OUT-SARIF-01
  - OUT-SARIF-02
  - OUT-SARIF-03
  - OUT-SARIF-04

must_haves:
  truths:
    - "docs/sarif-output.md explains SARIF format, rule IDs, severity mapping, and includes a complete GitHub Actions workflow snippet"
    - "docs/cli-reference.md documents --format sarif alongside json and console"
    - "README.md mentions SARIF output and GitHub Code Scanning integration"
    - "docs/examples.md shows SARIF usage examples"
    - "Publication READMEs are updated to mention SARIF output support"
  artifacts:
    - path: "docs/sarif-output.md"
      provides: "SARIF output format documentation with GitHub Actions workflow"
      contains: "upload-sarif"
    - path: "docs/cli-reference.md"
      provides: "Updated --format flag documentation"
      contains: "sarif"
    - path: "README.md"
      provides: "Updated feature list mentioning SARIF"
      contains: "SARIF"
  key_links:
    - from: "docs/sarif-output.md"
      to: "docs/cli-reference.md"
      via: "Cross-reference link to --format flag"
      pattern: "cli-reference"
    - from: "README.md"
      to: "docs/sarif-output.md"
      via: "Link to SARIF docs page"
      pattern: "sarif-output"
---

<objective>
Document the SARIF output format including rule definitions, severity mapping, GitHub Actions integration workflow, and update all user-facing documentation to reflect the new --format sarif capability.

Purpose: Enable users to discover and use SARIF output for GitHub Code Scanning integration with copy-paste-ready CI workflow.

Output: New `docs/sarif-output.md` page plus updates to README.md, docs/cli-reference.md, docs/getting-started.md, docs/examples.md, and all publication READMEs.
</objective>

<execution_context>
@/home/ben/.claude/get-shit-done/workflows/execute-plan.md
@/home/ben/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-sarif-output/09-CONTEXT.md
@.planning/phases/09-sarif-output/09-RESEARCH.md
@.planning/phases/09-sarif-output/09-01-SUMMARY.md

Key docs files:
@docs/cli-reference.md
@docs/getting-started.md
@docs/examples.md
@docs/health-score.md — style reference for a metric-specific docs page
@README.md
@publication/npm/README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SARIF output documentation page with GitHub Actions workflow</name>
  <files>docs/sarif-output.md</files>
  <action>
Create `docs/sarif-output.md` following the style of existing metric docs pages (health-score.md, cognitive-complexity.md) with the TanStack-style friendly and thorough tone per locked decision from Phase 05.1.

**Page structure:**

1. **Title & Intro** — What SARIF is, why it matters (GitHub Code Scanning, inline PR annotations)

2. **Quick Start** — Minimal command to generate SARIF:
   ```bash
   complexity-guard --format sarif . > results.sarif
   ```

3. **GitHub Actions Workflow** — Complete, copy-paste-ready workflow (locked decision from CONTEXT.md). Use the workflow from 09-RESEARCH.md but update the GitHub org URL to match the actual repository:
   ```yaml
   name: Complexity Guard
   on:
     push:
       branches: [main]
     pull_request:
       branches: [main]
   jobs:
     complexity:
       runs-on: ubuntu-latest
       permissions:
         security-events: write
         actions: read
         contents: read
       steps:
         - name: Checkout repository
           uses: actions/checkout@v4
         - name: Install complexity-guard
           run: npm install -g complexity-guard
         - name: Run complexity analysis
           run: complexity-guard --format sarif . > results.sarif
           continue-on-error: true
         - name: Upload SARIF to GitHub Code Scanning
           uses: github/codeql-action/upload-sarif@v4
           with:
             sarif_file: results.sarif
             category: complexity-guard
   ```
   Note: Use `npm install -g complexity-guard` since the npm package is already published (Phase 05.1). Add `continue-on-error: true` on the analysis step so SARIF upload still happens even when violations cause non-zero exit.

4. **Rule Reference** — Table of all 10 SARIF rules with id, name, and what triggers them:

   | Rule ID | Name | Triggers When |
   |---------|------|---------------|
   | `complexity-guard/cyclomatic` | CyclomaticComplexity | Cyclomatic complexity exceeds threshold |
   | `complexity-guard/cognitive` | CognitiveComplexity | Cognitive complexity exceeds threshold |
   | `complexity-guard/halstead-volume` | HalsteadVolume | Halstead volume exceeds threshold |
   | `complexity-guard/halstead-difficulty` | HalsteadDifficulty | Halstead difficulty exceeds threshold |
   | `complexity-guard/halstead-effort` | HalsteadEffort | Halstead effort exceeds threshold |
   | `complexity-guard/halstead-bugs` | HalsteadBugs | Halstead estimated bugs exceed threshold |
   | `complexity-guard/line-count` | LineCount | Function line count exceeds threshold |
   | `complexity-guard/param-count` | ParamCount | Parameter count exceeds threshold |
   | `complexity-guard/nesting-depth` | NestingDepth | Nesting depth exceeds threshold |
   | `complexity-guard/health-score` | HealthScore | File health score below baseline |

5. **Severity Mapping** — Explain how thresholds map to SARIF levels:
   - Warning threshold reached → SARIF `warning` level → yellow annotation in PR
   - Error threshold reached → SARIF `error` level → red annotation in PR
   - Baseline failure → SARIF `error` level at file level

6. **Filtering with --metrics** — Show how `--format sarif --metrics cyclomatic,cognitive` limits which violations appear in output. Explain this is useful for phased rollout (start with one metric, add more over time).

7. **Message Format** — Show example messages:
   - Function violation: `"Cyclomatic complexity is 15 (warning threshold: 10, error threshold: 20)"`
   - Health score: `"File health score: 42.5 (baseline: 60.0). Worst contributors: cyclomatic (3 violations), cognitive (2 violations)"`

8. **SARIF Structure** — Brief explanation with a trimmed JSON example showing the top-level shape (schema, version, runs, tool, rules, results). Reference the SARIF 2.1.0 spec for full details.

9. **Tips** — Practical advice:
   - Use `--output results.sarif` or redirect stdout
   - GitHub limits SARIF files to 5000 results — for very large codebases, use `--metrics` to focus on specific metrics
   - Annotations appear on PR diffs, not on unchanged files
   - `partialFingerprints` are auto-computed by GitHub (no manual fingerprinting needed)

10. **Links** — Cross-references to cli-reference.md (--format flag), getting-started.md, and metric-specific doc pages
  </action>
  <verify>
docs/sarif-output.md exists and contains: GitHub Actions workflow with upload-sarif@v4, rule reference table with all 10 rules, severity mapping explanation, --metrics filtering section, and example SARIF JSON structure.
  </verify>
  <done>
docs/sarif-output.md is a complete, user-friendly guide to SARIF output including a copy-paste-ready GitHub Actions workflow, all 10 rule IDs documented, severity mapping explained, and --metrics filtering covered.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update README, docs pages, and publication READMEs for SARIF support</name>
  <files>
    docs/cli-reference.md
    docs/getting-started.md
    docs/examples.md
    README.md
    publication/npm/README.md
    publication/npm/packages/darwin-arm64/README.md
    publication/npm/packages/darwin-x64/README.md
    publication/npm/packages/linux-arm64/README.md
    publication/npm/packages/linux-x64/README.md
    publication/npm/packages/windows-x64/README.md
  </files>
  <action>
**docs/cli-reference.md:**
- In the `--format` flag section, add `sarif` as a valid value alongside `console` and `json`
- Add description: `sarif` — SARIF 2.1.0 output for GitHub Code Scanning integration (see [SARIF Output](sarif-output.md))
- If there is a format values table, add the sarif row

**docs/getting-started.md:**
- In the output formats section (or features overview), mention SARIF alongside console and JSON
- Add a brief "CI Integration" or "GitHub Code Scanning" callout: "Use `--format sarif` to generate SARIF reports for GitHub Code Scanning. See [SARIF Output](sarif-output.md) for a complete GitHub Actions workflow."

**docs/examples.md:**
- Add a "SARIF Output" section with:
  - Basic usage: `complexity-guard --format sarif . > results.sarif`
  - Filtered: `complexity-guard --format sarif --metrics cyclomatic . > results.sarif`
  - With output file: `complexity-guard --format sarif --output results.sarif .`
  - Pipe to jq for inspection: `complexity-guard --format sarif . | jq '.runs[0].results | length'`

**README.md:**
- In the features section/list, add a bullet about SARIF output / GitHub Code Scanning integration
- In the output formats section (if exists), add SARIF
- Add a link to docs/sarif-output.md in the documentation links section
- Keep the existing feature list accurate — do not remove or change existing entries

**publication/npm/README.md:**
- Sync with main README changes — add SARIF mention to features list
- Keep consistent with main README

**Platform package READMEs (all 5):**
Each has a "What ComplexityGuard Measures" section (added in Phase 07-04). Add a line about output formats including SARIF, or add to features if an appropriate section exists. Keep changes minimal — these are discovery-focused READMEs.
  </action>
  <verify>
1. `grep -l "sarif" docs/cli-reference.md docs/getting-started.md docs/examples.md README.md publication/npm/README.md` — all files contain "sarif"
2. `grep -l "SARIF" publication/npm/packages/*/README.md` — all 5 platform READMEs mention SARIF
3. docs/cli-reference.md lists sarif as a --format value
4. docs/examples.md has SARIF usage examples
  </verify>
  <done>
All user-facing documentation updated: cli-reference.md documents --format sarif, getting-started.md mentions CI integration, examples.md shows SARIF commands, README.md features SARIF/GitHub Code Scanning, publication READMEs synced. All docs link to the new sarif-output.md page.
  </done>
</task>

</tasks>

<verification>
1. docs/sarif-output.md exists with complete GitHub Actions workflow
2. All 10 SARIF rule IDs documented in sarif-output.md
3. docs/cli-reference.md mentions --format sarif
4. docs/getting-started.md mentions SARIF / CI integration
5. docs/examples.md has SARIF usage examples
6. README.md mentions SARIF and links to docs
7. publication/npm/README.md synced with README.md SARIF changes
8. All 5 platform package READMEs mention SARIF
9. No broken cross-reference links in documentation
</verification>

<success_criteria>
- New docs/sarif-output.md page is comprehensive: GitHub Actions workflow, rule reference, severity mapping, filtering, tips
- All existing docs pages updated to mention SARIF as a format option
- README.md and publication READMEs mention SARIF / GitHub Code Scanning
- Documentation tone matches TanStack-style friendly and thorough convention
</success_criteria>

<output>
After completion, create `.planning/phases/09-sarif-output/09-02-SUMMARY.md`
</output>
