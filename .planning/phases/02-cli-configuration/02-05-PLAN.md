---
phase: 02-cli-configuration
plan: 05
type: execute
wave: 4
depends_on: ["02-04"]
files_modified:
  - src/main.zig
autonomous: false

must_haves:
  truths:
    - "complexityguard --help shows compact grouped help fitting one screen"
    - "complexityguard --version shows version string"
    - "complexityguard (bare) prints placeholder with default path '.'"
    - "complexityguard --format json src/ accepts flag and path"
    - "complexityguard --foramt gives did-you-mean suggestion"
    - "complexityguard with .complexityguard.json present loads it without error"
    - "zig build test passes all tests"
  artifacts:
    - path: "src/main.zig"
      provides: "Complete CLI entry point"
      min_lines: 30
  key_links:
    - from: "src/main.zig"
      to: "all cli modules"
      via: "imports and function calls"
      pattern: "cli\\."
---

<objective>
Verify the complete Phase 2 CLI and configuration system end-to-end. Human checkpoint to confirm the CLI feels right.

Purpose: Catch integration issues and verify the CLI personality matches expectations before moving to Phase 3.
Output: Verified, working CLI ready for file discovery integration.
</objective>

<execution_context>
@/home/ben/.claude/get-shit-done/workflows/execute-plan.md
@/home/ben/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-cli-configuration/02-CONTEXT.md
@.planning/phases/02-cli-configuration/02-04-SUMMARY.md
@src/main.zig
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run comprehensive integration tests</name>
  <files>src/main.zig</files>
  <action>
Run the full test suite and fix any issues:

1. `zig build test` -- all unit tests must pass
2. `zig build` -- binary must compile
3. Test CLI behavior manually:
   a. `zig build run -- --help` -- verify help output is compact and grouped
   b. `zig build run -- --version` -- verify version output
   c. `zig build run` -- verify bare invocation defaults to "."
   d. `zig build run -- --format json src/` -- verify flags + paths work
   e. `zig build run -- -f json -o report.json src/` -- verify short aliases
   f. `zig build run -- --verbose --format sarif .` -- verify multiple flags

4. Create a test config file `.complexityguard.json` in the project root:
   ```json
   {
     "output": {
       "format": "json"
     },
     "analysis": {
       "thresholds": {
         "cyclomatic": {
           "warning": 10,
           "error": 20
         }
       }
     },
     "files": {
       "exclude": ["node_modules", "dist"]
     }
   }
   ```

5. Test config loading:
   a. `zig build run` -- should load config without error
   b. `zig build run -- --format console` -- flag should override config's "json"

6. Remove the test config file after testing: `rm .complexityguard.json`

7. If any tests fail, fix the issues in the relevant source files.

8. Verify binary size: `ls -la zig-out/bin/complexity-guard` -- should be reasonable (exact size depends on deps, but check it's not unexpectedly huge).
  </action>
  <verify>
All manual tests produce expected output. `zig build test` passes. No unexpected errors.
  </verify>
  <done>All integration tests pass. CLI accepts all flags, loads config, and produces expected output.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of CLI personality and completeness</name>
  <action>
Present the CLI to the user for verification. The user should run these commands and confirm the CLI matches their vision:

1. `zig build run -- --help` -- compact, grouped by category, fits one screen, ripgrep-style
2. `zig build run -- --version` -- shows version
3. `zig build run` -- defaults to current directory
4. `zig build run -- --format json src/` -- flags and paths accepted
5. (Optional) `zig build run -- --init` -- interactive setup generates config file
6. Overall CLI personality matches ripgrep/fd inspiration
  </action>
  <verify>User confirms CLI personality and behavior match expectations.</verify>
  <done>User approves Phase 2 CLI and configuration system.</done>
</task>

</tasks>

<verification>
Phase 2 success criteria (from ROADMAP.md):
1. User can run `complexityguard [paths...]` and see usage help -- verified via --help
2. User can specify all flags and flags override config file values -- verified via flag tests + config override test
3. Tool loads `.complexityguard.json` when present and validates schema -- verified via config loading test
4. Tool displays version with `--version` and help with `--help` -- verified via command tests
</verification>

<success_criteria>
- All four ROADMAP success criteria verified
- Human approves CLI personality and help output
- zig build test passes
- Binary compiles and runs correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-cli-configuration/02-05-SUMMARY.md`
</output>
