---
phase: 05.1-ci-cd-release-pipeline-documentation
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - publication/npm/package.json
  - publication/npm/bin/complexity-guard.js
  - publication/npm/packages/darwin-arm64/package.json
  - publication/npm/packages/darwin-x64/package.json
  - publication/npm/packages/linux-arm64/package.json
  - publication/npm/packages/linux-x64/package.json
  - publication/npm/packages/windows-x64/package.json
  - publication/homebrew/complexity-guard.rb
  - .github/workflows/release.yml
  - scripts/release.sh
  - scripts/publish.sh
  - .gitignore
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All publication files live under publication/ directory (publication/npm/, publication/homebrew/)"
    - "No npm/Homebrew files exist at project root (no root package.json, bin/, npm/, homebrew/)"
    - "Release workflow still correctly references all publication files at new paths"
    - "Release script still correctly updates version in all publication files at new paths"
    - "Publish script still correctly publishes from new paths"
    - ".gitignore still ignores platform binaries at new paths"
  artifacts:
    - path: "publication/npm/package.json"
      provides: "Main npm package manifest"
      contains: "complexity-guard"
    - path: "publication/npm/bin/complexity-guard.js"
      provides: "Node.js wrapper script"
      contains: "PLATFORM_MAP"
    - path: "publication/npm/packages/darwin-arm64/package.json"
      provides: "macOS ARM64 platform package"
      contains: "@complexity-guard/darwin-arm64"
    - path: "publication/homebrew/complexity-guard.rb"
      provides: "Homebrew formula template"
      contains: "ComplexityGuard < Formula"
    - path: ".github/workflows/release.yml"
      provides: "Updated release pipeline with publication/ paths"
      contains: "publication/"
    - path: "scripts/release.sh"
      provides: "Updated release script with publication/ paths"
      contains: "publication/"
    - path: "scripts/publish.sh"
      provides: "Updated publish script with publication/ paths"
      contains: "publication/"
  key_links:
    - from: ".github/workflows/release.yml"
      to: "publication/npm/package.json"
      via: "npm publish from publication/npm directory"
      pattern: "publication/npm"
    - from: ".github/workflows/release.yml"
      to: "publication/homebrew/complexity-guard.rb"
      via: "sed replacement of SHA256 placeholders"
      pattern: "publication/homebrew/complexity-guard.rb"
    - from: "scripts/release.sh"
      to: "publication/npm/package.json"
      via: "version update via sed"
      pattern: "publication/npm"
---

<objective>
Move all publication/distribution files from the project root into a scoped `publication/` directory structure: `publication/npm/` for npm packages and `publication/homebrew/` for the Homebrew formula. Update all path references in workflows, scripts, and .gitignore.

Purpose: User requested publication files be scoped to a dedicated folder instead of cluttering the project root (UAT Gap 2, Test 4).
Output: All publication files under `publication/`, all references updated, no broken paths.
</objective>

<execution_context>
@/Users/benvds/.claude/get-shit-done/workflows/execute-plan.md
@/Users/benvds/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05.1-ci-cd-release-pipeline-documentation/05.1-02-SUMMARY.md
@.planning/phases/05.1-ci-cd-release-pipeline-documentation/05.1-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move publication files to publication/ directory structure</name>
  <files>
    publication/npm/package.json
    publication/npm/bin/complexity-guard.js
    publication/npm/packages/darwin-arm64/package.json
    publication/npm/packages/darwin-arm64/.gitkeep
    publication/npm/packages/darwin-x64/package.json
    publication/npm/packages/darwin-x64/.gitkeep
    publication/npm/packages/linux-arm64/package.json
    publication/npm/packages/linux-arm64/.gitkeep
    publication/npm/packages/linux-x64/package.json
    publication/npm/packages/linux-x64/.gitkeep
    publication/npm/packages/windows-x64/package.json
    publication/npm/packages/windows-x64/.gitkeep
    publication/homebrew/complexity-guard.rb
  </files>
  <action>
    Use `git mv` to move files preserving git history. The new structure is:

    ```
    publication/
      npm/
        package.json          (was: package.json)
        bin/
          complexity-guard.js (was: bin/complexity-guard.js)
        packages/
          darwin-arm64/       (was: npm/darwin-arm64/)
          darwin-x64/         (was: npm/darwin-x64/)
          linux-arm64/        (was: npm/linux-arm64/)
          linux-x64/          (was: npm/linux-x64/)
          windows-x64/        (was: npm/windows-x64/)
      homebrew/
        complexity-guard.rb   (was: homebrew/complexity-guard.rb)
    ```

    Steps:
    1. Create directory structure: `mkdir -p publication/npm/bin publication/npm/packages publication/homebrew`
    2. Move files with `git mv`:
       - `git mv package.json publication/npm/package.json`
       - `git mv bin/complexity-guard.js publication/npm/bin/complexity-guard.js` then `rmdir bin`
       - `git mv npm/darwin-arm64 publication/npm/packages/darwin-arm64` (repeat for all 5 platforms)
       - `git mv homebrew/complexity-guard.rb publication/homebrew/complexity-guard.rb` then `rmdir homebrew`
    3. Update `publication/npm/package.json`: change `"bin"` path from `"bin/complexity-guard.js"` to `"bin/complexity-guard.js"` (stays same relative to package.json location). Change `"files"` from `["bin/"]` to `["bin/"]` (stays same).
    4. Verify no old files remain: `ls package.json bin/ npm/ homebrew/` should all fail.
  </action>
  <verify>
    - `test -f publication/npm/package.json` exits 0
    - `test -f publication/npm/bin/complexity-guard.js` exits 0
    - `test -f publication/npm/packages/darwin-arm64/package.json` exits 0
    - `test -f publication/npm/packages/windows-x64/package.json` exits 0
    - `test -f publication/homebrew/complexity-guard.rb` exits 0
    - `test ! -f package.json` exits 0 (old file gone)
    - `test ! -d bin` exits 0 (old dir gone)
    - `test ! -d npm` exits 0 (old dir gone)
    - `test ! -d homebrew` exits 0 (old dir gone)
  </verify>
  <done>All publication files exist under publication/ directory. No publication files remain at project root.</done>
</task>

<task type="auto">
  <name>Task 2: Update all path references in workflows, scripts, and .gitignore</name>
  <files>
    .github/workflows/release.yml
    scripts/release.sh
    scripts/publish.sh
    .gitignore
  </files>
  <action>
    Update every file that references the old publication file paths.

    **`.github/workflows/release.yml`** -- Update ALL path references. Key changes:
    - npm-publish job: `npm/` -> `publication/npm/packages/` for platform package paths
    - npm-publish job: Extract binaries to `publication/npm/packages/<platform>/` instead of `npm/<platform>/`
    - npm-publish job: Update version in `publication/npm/package.json` instead of `package.json`
    - npm-publish job: Platform packages loop: `publication/npm/packages/darwin-arm64` etc.
    - npm-publish job: Binary verification paths: `publication/npm/packages/$pkg/complexity-guard`
    - npm-publish job: Main package publish: `cd publication/npm && npm publish --access public`
    - npm-publish job: optionalDependencies sed in `publication/npm/package.json`
    - homebrew-update job: `homebrew/complexity-guard.rb` -> `publication/homebrew/complexity-guard.rb` (4 occurrences for sed replacements plus the cat)

    **`scripts/release.sh`** -- Update version bump paths:
    - Line 58-62: `package.json` -> `publication/npm/package.json` and `git add publication/npm/package.json`
    - Line 65-73: `npm/*/package.json` -> `publication/npm/packages/*/package.json` (the -d check, the glob, and the git add)

    **`scripts/publish.sh`** -- Update publish paths:
    - Line 56: `$PROJECT_ROOT/npm/$platform` -> `$PROJECT_ROOT/publication/npm/packages/$platform`
    - Line 67: Main package publish: `cd "$PROJECT_ROOT"` -> `cd "$PROJECT_ROOT/publication/npm"`

    **`.gitignore`** -- Update binary ignore patterns:
    - `npm/*/complexity-guard` -> `publication/npm/packages/*/complexity-guard`
    - `npm/*/complexity-guard.exe` -> `publication/npm/packages/*/complexity-guard.exe`
  </action>
  <verify>
    - `grep -r 'npm/' .github/workflows/release.yml | grep -v 'publication/npm'` returns no results (all npm paths updated)
    - `grep -r 'homebrew/' .github/workflows/release.yml | grep -v 'publication/homebrew'` returns no results
    - `grep 'package.json' scripts/release.sh | grep -v 'publication/' | grep -v 'pkg_json'` returns no results (all package.json refs updated)
    - `grep 'npm/' scripts/publish.sh | grep -v 'publication/npm'` returns no results
    - `grep 'npm/' .gitignore | grep -v 'publication/npm'` returns no results
    - `zig build test` passes (Zig code unaffected)
  </verify>
  <done>All 4 config files reference publication/ paths. No stale references to old root-level publication paths remain in any workflow, script, or gitignore.</done>
</task>

</tasks>

<verification>
1. `find publication/ -type f | sort` lists all expected files
2. `test ! -f package.json && test ! -d bin && test ! -d npm && test ! -d homebrew` -- no old files at root
3. `grep -rn 'publication/' .github/workflows/release.yml | wc -l` shows 18+ updated references
4. `grep -rn 'publication/' scripts/release.sh` shows updated version bump paths
5. `grep -rn 'publication/' scripts/publish.sh` shows updated publish paths
6. `grep 'publication/' .gitignore` shows updated ignore patterns
7. `zig build test` passes -- core project unaffected by publication file moves
</verification>

<success_criteria>
- All publication files live under publication/ (npm/ and homebrew/ subdirectories)
- No publication files exist at project root
- Release workflow, release script, publish script, and .gitignore all reference new paths
- Zero stale path references to old locations
- Zig build and tests still pass (core project unaffected)
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-ci-cd-release-pipeline-documentation/05.1-05-SUMMARY.md`
</output>
